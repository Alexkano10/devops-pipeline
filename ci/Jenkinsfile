pipeline {
    agent any
    
    environment {
        DOCKER_REGISTRY = 'localhost:5000'
        APP_NAME = 'devops-pipeline'
        BACKEND_IMAGE = "${DOCKER_REGISTRY}/${APP_NAME}/backend:${env.BUILD_NUMBER}"
        FRONTEND_IMAGE = "${DOCKER_REGISTRY}/${APP_NAME}/frontend:${env.BUILD_NUMBER}"
        BACKEND_LATEST = "${DOCKER_REGISTRY}/${APP_NAME}/backend:latest"
        FRONTEND_LATEST = "${DOCKER_REGISTRY}/${APP_NAME}/frontend:latest"
        WORKSPACE = "${env.WORKSPACE}"
    }
    
    
    stages {

        stage('Clean Workspace') {
            steps {
                deleteDir()
            }
        }

        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
    }
    post {
        success {
            echo 'Pipeline completed successfully!'
        }
        failure {
            echo 'Pipeline failed!'
        }
        always {
            sh 'docker system prune -f'
        }
    }
}